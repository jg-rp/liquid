"use strict";(self.webpackChunkliquid_docs=self.webpackChunkliquid_docs||[]).push([[7444],{7611:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var a=n(3117),l=(n(7294),n(3905));const i={},r="Contextual Template Analysis",s={unversionedId:"guides/contextual-template-analysis",id:"guides/contextual-template-analysis",title:"Contextual Template Analysis",description:"_New in version 1.3.0_",source:"@site/docs/guides/contextual-template-analysis.md",sourceDirName:"guides",slug:"/guides/contextual-template-analysis",permalink:"/liquid/guides/contextual-template-analysis",draft:!1,editUrl:"https://github.com/jg-rp/liquid/tree/docs/docs/guides/contextual-template-analysis.md",tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Static Template Analysis",permalink:"/liquid/guides/static-template-analysis"},next:{title:"Undefined Variables",permalink:"/liquid/guides/undefined-variables"}},o={},p=[{value:"Limitations",id:"limitations",level:2},{value:"Usage",id:"usage",level:2},{value:"Local Variables",id:"local-variables",level:2},{value:"Undefined variables",id:"undefined-variables",level:2}],u={toc:p};function d(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"contextual-template-analysis"},"Contextual Template Analysis"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("em",{parentName:"strong"},"New in version 1.3.0"))),(0,l.kt)("p",null,"Complementing ",(0,l.kt)("a",{parentName:"p",href:"/liquid/guides/static-template-analysis"},"static template analysis"),", added in Python Liquid version 1.2.0, contextual template analysis renders a template and captures information about template variable usage as it goes."),(0,l.kt)("p",null,"Given some ",(0,l.kt)("a",{parentName:"p",href:"/liquid/introduction/render-context"},"render context")," data, ",(0,l.kt)("a",{parentName:"p",href:"/liquid/api/BoundTemplate#analyze_with_context"},(0,l.kt)("inlineCode",{parentName:"a"},"BoundTemplate.analyze_with_context()"))," will visit nodes in a template's syntax tree as if it were being rendered, excluding those nodes that are not reachable using the current render context."),(0,l.kt)("h2",{id:"limitations"},"Limitations"),(0,l.kt)("p",null,"Due to limitations of the current implementation, Python Liquid does not support template introspection from within a render context or ",(0,l.kt)("inlineCode",{parentName:"p"},"Expression")," object. Meaning line numbers and template names are not available when using contextual template analysis. Only variable names are reported along with the number of times they were referenced. This is not the case with ",(0,l.kt)("a",{parentName:"p",href:"/liquid/guides/static-template-analysis"},"static template analysis"),"."),(0,l.kt)("p",null,"It's also not currently possible to detect names added to a block's scope. For example, ",(0,l.kt)("inlineCode",{parentName:"p"},"forloop.index")," will be included in the results object if referenced within a for loop block."),(0,l.kt)("h2",{id:"usage"},"Usage"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"/liquid/api/BoundTemplate#analyze_with_context"},(0,l.kt)("inlineCode",{parentName:"a"},"BoundTemplate.analyze_with_context()"))," and ",(0,l.kt)("a",{parentName:"p",href:"/liquid/api/BoundTemplate#analyze_with_context_async"},(0,l.kt)("inlineCode",{parentName:"a"},"BoundTemplate.analyze_with_context_async()"))," accept the same arguments as ",(0,l.kt)("a",{parentName:"p",href:"/liquid/api/BoundTemplate#render"},(0,l.kt)("inlineCode",{parentName:"a"},"BoundTemplate.render()")),". The returned object is an instance of ",(0,l.kt)("a",{parentName:"p",href:"/liquid/api/contextual-template-analysis"},(0,l.kt)("inlineCode",{parentName:"a"},"ContextualTemplateAnalysis")),". Each of its properties is a dictionary mapping template variable name to the number of times that name was referenced."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"ContextualTemplateAnalysis.all_variables")," includes all variable names discovered while rendering a template given some render context data. It will not include variables from blocks that would not have been rendered."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'from liquid import Template\n\ntemplate = Template("""\\\n{% assign fallback = \'anonymous\' %}\n{% if user %}\n  Hello, {{ user.name }}.\n{% else %}\n  Hello, {{ fallback }}\n{% endif %}\n""")\n\n# `user` is undefined\nanalysis = template.analyze_with_context()\nprint(list(analysis.all_variables))\n\n\n# `user` is defined\nanalysis = template.analyze_with_context(user={"name": "Sally"})\nprint(list(analysis.all_variables))\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-plain",metastring:'title="output"',title:'"output"'},"['user', 'fallback']\n['user', 'user.name']\n")),(0,l.kt)("h2",{id:"local-variables"},"Local Variables"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"ContextualTemplateAnalysis.local_variables")," includes variable names that have been assigned with the ",(0,l.kt)("inlineCode",{parentName:"p"},"assign"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"capture"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"increment")," or ",(0,l.kt)("inlineCode",{parentName:"p"},"decrement")," tags, or any custom tag that uses ",(0,l.kt)("inlineCode",{parentName:"p"},"Context.assign()"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'from liquid import Template\n\ntemplate = Template("""\\\n{% assign fallback = \'anonymous\' %}\n{% if user %}\n  Hello, {{ user.name }}.\n{% else %}\n  Hello, {{ fallback }}\n{% endif %}\n""")\n\n# `user` is undefined\nanalysis = template.analyze_with_context()\nprint(list(analysis.local_variables))\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-plain",metastring:'title="output"',title:'"output"'},"['fallback']\n")),(0,l.kt)("h2",{id:"undefined-variables"},"Undefined variables"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"ContextualTemplateAnalysis.undefined_variables")," includes variable names that could not be resolved in the current render context. If a name is referenced before it is assigned, it will appear in ",(0,l.kt)("inlineCode",{parentName:"p"},"undefined_variables")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"local_variables"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'from liquid import Template\n\ntemplate = Template("""\\\n{% assign fallback = \'anonymous\' %}\n{{ nosuchthing }}\n\n{% if user %}\n  Hello, {{ user.name }}.\n{% else %}\n  Hello, {{ fallback }}\n{% endif %}\n""")\n\n# `user` is undefined\nanalysis = template.analyze_with_context()\nprint(list(analysis.undefined_variables))\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-plain",metastring:'title="output"',title:'"output"'},"['nosuchthing', 'user']\n")))}d.isMDXComponent=!0},3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>c});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var o=a.createContext({}),p=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(o.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,i=e.originalType,o=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=p(n),c=l,f=m["".concat(o,".").concat(c)]||m[c]||d[c]||i;return n?a.createElement(f,r(r({ref:t},u),{},{components:n})):a.createElement(f,r({ref:t},u))}));function c(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var i=n.length,r=new Array(i);r[0]=m;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s.mdxType="string"==typeof e?e:l,r[1]=s;for(var p=2;p<i;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"}}]);
"use strict";(self.webpackChunkliquid_docs=self.webpackChunkliquid_docs||[]).push([[1846],{3905:(e,t,a)=>{a.d(t,{Zo:()=>m,kt:()=>g});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},m=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),d=p(a),c=r,g=d["".concat(s,".").concat(c)]||d[c]||u[c]||l;return a?n.createElement(g,i(i({ref:t},m),{},{components:a})):n.createElement(g,i({ref:t},m))}));function g(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,i=new Array(l);i[0]=c;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[d]="string"==typeof e?e:r,i[1]=o;for(var p=2;p<l;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},9503:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const l={},i="Python Liquid Babel",o={unversionedId:"babel/introduction",id:"babel/introduction",title:"Python Liquid Babel",description:"Liquid Babel is a collection of optional filters and tags that facilitate the internationalization (i18n) and localization (i10n) of Liquid templates.",source:"@site/docs/babel/introduction.md",sourceDirName:"babel",slug:"/babel/introduction",permalink:"/liquid/babel/introduction",draft:!1,editUrl:"https://github.com/jg-rp/liquid/tree/docs/docs/babel/introduction.md",tags:[],version:"current",frontMatter:{},sidebar:"languageSidebar",previous:{title:"Extra Tags",permalink:"/liquid/extra/tags"},next:{title:"Babel Filters",permalink:"/liquid/babel/filters"}},s={},p=[{value:"Install",id:"install",level:2},{value:"Filters",id:"filters",level:2},{value:"Tags",id:"tags",level:2},{value:"Translations",id:"translations",level:2},{value:"Message Catalogs",id:"message-catalogs",level:3},{value:"Message Variables",id:"message-variables",level:3},{value:"Message Extraction",id:"message-extraction",level:3},{value:"Translator Comments",id:"translator-comments",level:3}],m={toc:p},d="wrapper";function u(e){let{components:t,...a}=e;return(0,r.kt)(d,(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"python-liquid-babel"},"Python Liquid Babel"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/jg-rp/liquid-babel"},"Liquid Babel")," is a collection of optional ",(0,r.kt)("a",{parentName:"p",href:"/liquid/language/filters"},"filters")," and ",(0,r.kt)("a",{parentName:"p",href:"/liquid/language/tags"},"tags")," that facilitate the internationalization (i18n) and localization (i10n) of Liquid templates."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Liquid Babel uses ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/python-babel/babel"},"Python Babel"),". Please refer to the ",(0,r.kt)("a",{parentName:"p",href:"https://babel.pocoo.org/en/latest/index.html"},"Babel docs")," for more information about working with message catalogs, locales, currency codes and format strings.")),(0,r.kt)("h2",{id:"install"},"Install"),(0,r.kt)("p",null,"Install Python Liquid Babel using ",(0,r.kt)("a",{parentName:"p",href:"https://pipenv.pypa.io/en/latest/"},"pipenv"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"$ pipenv install liquid-babel\n")),(0,r.kt)("p",null,"Or ",(0,r.kt)("a",{parentName:"p",href:"https://pip.pypa.io/en/stable/getting-started/"},"pip"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"$ python -m pip install -U liquid-babel\n")),(0,r.kt)("h2",{id:"filters"},"Filters"),(0,r.kt)("p",null,"Liquid Babel filters are implemented as Python classes. Pass options to a filter constructor, then register the resulting instance with a Liquid ",(0,r.kt)("a",{parentName:"p",href:"/liquid/api/Environment"},(0,r.kt)("inlineCode",{parentName:"a"},"Environment"))," by calling its ",(0,r.kt)("a",{parentName:"p",href:"/liquid/api/Environment#add_filter"},(0,r.kt)("inlineCode",{parentName:"a"},"add_filter()"))," method."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'from liquid import Environment\nfrom liquid_babel.filters import Currency\n\nenv = Environment()\nenv.add_filter("currency", Currency(\n    default_locale="en_CA",\n    default_format="#,##0.00",\n))\n\ntemplate = env.from_string("{{ 100457.99 | currency }}")\nprint(template.render())\n')),(0,r.kt)("h2",{id:"tags"},"Tags"),(0,r.kt)("p",null,"Liquid Babel tags can be registered with an ",(0,r.kt)("a",{parentName:"p",href:"/liquid/api/Environment"},(0,r.kt)("inlineCode",{parentName:"a"},"Environment"))," using its ",(0,r.kt)("a",{parentName:"p",href:"/liquid/api/Environment#addtag"},(0,r.kt)("inlineCode",{parentName:"a"},"add_tag()"))," method. ",(0,r.kt)("a",{parentName:"p",href:"/liquid/api/Tag"},"Tags")," are configured by setting attributes on a subclass. This example changes the name of the default ",(0,r.kt)("a",{parentName:"p",href:"/liquid/babel/tags#translate"},(0,r.kt)("inlineCode",{parentName:"a"},"translate"))," tag to ",(0,r.kt)("inlineCode",{parentName:"p"},"trans")," and disables whitespace normalization in translation messages."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'from liquid import Environment\nfrom liquid_babel.tags.translate import TranslateTag\n\nclass MyTranslateTag(TranslateTag):\n    name = "trans"\n    end = "endtrans"\n    trim_messages = False\n\nenv = Environment()\nenv.add_tag(MyTranslateTag)\n\nsource = """\n{%- trans count: worlds | size, you: \'World\' -%}\n    Hello, {{ you }}!\n{%- plural -%}\n    Hello, {{ you }}s!\n{%- endtrans -%}\n"""\n\ntemplate = env.from_string(source)\n\n# With default NullTranslation\nprint(template.render())\n')),(0,r.kt)("h2",{id:"translations"},"Translations"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"New in Liquid Babel version 0.3.0"))),(0,r.kt)("p",null,"Liquid Babel includes ",(0,r.kt)("a",{parentName:"p",href:"/liquid/babel/filters#gettext"},(0,r.kt)("inlineCode",{parentName:"a"},"gettext")),", ",(0,r.kt)("a",{parentName:"p",href:"/liquid/babel/filters#ngettext"},(0,r.kt)("inlineCode",{parentName:"a"},"ngettext")),", ",(0,r.kt)("a",{parentName:"p",href:"/liquid/babel/filters#pgettext"},(0,r.kt)("inlineCode",{parentName:"a"},"pgettext"))," and ",(0,r.kt)("a",{parentName:"p",href:"/liquid/babel/filters#npgettext"},(0,r.kt)("inlineCode",{parentName:"a"},"npgettext"))," filter equivalents to the functions found in ",(0,r.kt)("a",{parentName:"p",href:"https://docs.python.org/3.10/library/gettext.html#gnu-gettext-api"},"Python's gettext module"),". Application developers can choose to use any of these filters, possibly using more user friendly filter names, and/or the more general ",(0,r.kt)("a",{parentName:"p",href:"/liquid/babel/filters#t"},(0,r.kt)("inlineCode",{parentName:"a"},"t (translate)"))," filter."),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"/liquid/babel/filters#t"},(0,r.kt)("inlineCode",{parentName:"a"},"t"))," filter can behave like any of the ","*","gettext filters, depending on the arguments it is given. Where the ","*","gettext filters require positional arguments for ",(0,r.kt)("inlineCode",{parentName:"p"},"context"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"count")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"plural"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"t")," reserves optional ",(0,r.kt)("inlineCode",{parentName:"p"},"count")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"plural")," keyword arguments. See the ",(0,r.kt)("a",{parentName:"p",href:"/liquid/babel/filters"},"Liquid Babel filter reference")," for filter configuration and usage examples."),(0,r.kt)("p",null,"Liquid Babel also offers a ",(0,r.kt)("a",{parentName:"p",href:"/liquid/babel/tags#translate"},(0,r.kt)("inlineCode",{parentName:"a"},"{% translate %}"))," tag. This is similar to the ",(0,r.kt)("a",{parentName:"p",href:"https://jinja.palletsprojects.com/en/3.1.x/templates/#i18n"},(0,r.kt)("inlineCode",{parentName:"a"},"{% trans %}"))," tag found in Jinja or the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.djangoproject.com/en/4.1/topics/i18n/translation/#blocktranslate-template-tag"},(0,r.kt)("inlineCode",{parentName:"a"},"{% blocktranslate %}"))," tag found in Django's template language. Again, application developers can configure and customize the included ",(0,r.kt)("inlineCode",{parentName:"p"},"translate")," tag to suit an application's needs. See the ",(0,r.kt)("a",{parentName:"p",href:"/liquid/babel/tags"},"Liquid Babel tag reference")," for customization and usage examples."),(0,r.kt)("h3",{id:"message-catalogs"},"Message Catalogs"),(0,r.kt)("p",null,"By default, all translation filters and tags will look for a render context variable called ",(0,r.kt)("inlineCode",{parentName:"p"},"translations"),", which must be an object implementing the ",(0,r.kt)("inlineCode",{parentName:"p"},"Translations")," protocol. It is the application developer's responsibility to provide a ",(0,r.kt)("inlineCode",{parentName:"p"},"Translations")," object, being the interface between Liquid and a message catalog."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"Translations")," protocol is defined as follows. It is simply a subset of the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.python.org/3.10/library/gettext.html#gettext.NullTranslations"},(0,r.kt)("inlineCode",{parentName:"a"},"NullTranslations"))," class found in the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.python.org/3.10/library/gettext.html#gnu-gettext-api"},"gettext module"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"class Translations(Protocol):\n    def gettext(self, message: str) -> str:\n        ...\n\n    def ngettext(self, singular: str, plural: str, n: int) -> str:\n        ...\n\n    def pgettext(self, context: str, message: str) -> str:\n        ...\n\n    def npgettext(self, context: str, singular: str, plural: str, n: int) -> str:\n        ...\n")),(0,r.kt)("p",null,"It could be a ",(0,r.kt)("a",{parentName:"p",href:"https://docs.python.org/3.10/library/gettext.html#the-gnutranslations-class"},(0,r.kt)("inlineCode",{parentName:"a"},"GNUTranslations"))," instance, a ",(0,r.kt)("a",{parentName:"p",href:"https://babel.pocoo.org/en/latest/support.html#extended-translations-class"},"Babel ",(0,r.kt)("inlineCode",{parentName:"a"},"Translations"))," instance, or any object implementing ",(0,r.kt)("inlineCode",{parentName:"p"},"gettext"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"ngettext"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"pgettext")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"npgettext")," methods."),(0,r.kt)("h3",{id:"message-variables"},"Message Variables"),(0,r.kt)("p",null,"Translatable message text can contain placeholders for variables. When using variables in strings to be translated by Liquid Babel filters, variables are defined using percent-style formatting. Only the ",(0,r.kt)("inlineCode",{parentName:"p"},"s")," modifier is supported and every variable must have a name. In this example ",(0,r.kt)("inlineCode",{parentName:"p"},"you")," is the variable name."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-liquid"},'{{ "Hello, %(you)s!" | t }}\n')),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Message variables can be disabled by setting the ",(0,r.kt)("inlineCode",{parentName:"p"},"message_interpolation")," argument to ",(0,r.kt)("inlineCode",{parentName:"p"},"False")," when instantiating any of the included translation filters.")),(0,r.kt)("p",null,"Filter keyword arguments are merged with the current render context before being used to replace variables in message text. All variables are converted to their string representation before substitution. Dotted property/attribute access is not supported inside message variables."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-liquid"},'{{ "Hello, %(you)s!" | t: you: user.name }}\n')),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"/liquid/babel/tags#translate"},(0,r.kt)("inlineCode",{parentName:"a"},"translate"))," block tag recognizes simplified Liquid output statements as translation message variables. These variables must be valid identifiers without dotted or bracketed property/attribute access, and no filters."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-liquid"},"{% translate %}\n    Hello, {{ you }}!\n{% endtranslate %}\n")),(0,r.kt)("p",null,"Keyword arguments passed to the ",(0,r.kt)("a",{parentName:"p",href:"/liquid/babel/tags#translate"},(0,r.kt)("inlineCode",{parentName:"a"},"translate"))," tag will be merged with the current render context before being used to replace variables in message text. These arguments can use simple, no-argument filters, like ",(0,r.kt)("inlineCode",{parentName:"p"},"size"),". You should expect a ",(0,r.kt)("inlineCode",{parentName:"p"},"TranslationSyntaxError")," if unexpected filters or filter arguments are used."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-liquid"},"{% translate you: user.name | capitalize, count: users | size %}\n    Hello, {{ you }}!\n{% plural %}\n    Hello, {{ you }}s!\n{% endtranslate %}\n")),(0,r.kt)("h3",{id:"message-extraction"},"Message Extraction"),(0,r.kt)("p",null,"Use the ",(0,r.kt)("inlineCode",{parentName:"p"},"liquid_babel.messages.extract_from_templates()")," function to build a message ",(0,r.kt)("a",{parentName:"p",href:"https://babel.pocoo.org/en/latest/api/messages/catalog.html#catalogs"},"catalog")," from one or more templates. You are then free to make use of ",(0,r.kt)("a",{parentName:"p",href:"https://babel.pocoo.org/en/latest/api/messages/pofile.html"},"Babel's PO file features"),", or convert the catalog to a more convenient internal representation."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'import io\n\nfrom babel.messages.pofile import write_po\n\nfrom liquid import Environment\nfrom liquid_babel.filters import register_translation_filters\nfrom liquid_babel.messages import extract_from_templates\nfrom liquid_babel.tags import TranslateTag\n\nenv = Environment()\nregister_translation_filters(env)\nenv.add_tag(TranslateTag)\n\nsource = """\n{% # Translators: some comment %}\n{{ \'Hello, World!\' | t }}\n{% comment %}Translators: other comment{% endcomment %}\n{% translate count: 2 %}\n    Hello, {{ you }}!\n{% plural %}\n    Hello, all!\n{% endtranslate %}\n"""\n\ntemplate = env.from_string(source, name="something.liquid")\ncatalog = extract_from_templates(template)\n\nbuf = io.BytesIO()\nwrite_po(buf, catalog, omit_header=True)\nprint(buf.getvalue().decode("utf-8"))\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-plain",metastring:'title="output"',title:'"output"'},'#. Translators: some comment\n#: something.liquid:3\nmsgid "Hello, World!"\nmsgstr ""\n\n#. Translators: other comment\n#: something.liquid:5\n#, python-format\nmsgid "Hello, %(you)s!"\nmsgid_plural "Hello, all!"\nmsgstr[0] ""\nmsgstr[1] ""\n')),(0,r.kt)("p",null,"Liquid Babel also includes a Babel compatible ",(0,r.kt)("a",{parentName:"p",href:"https://babel.pocoo.org/en/latest/messages.html#extraction-method-mapping-and-configuration"},"extraction method"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"liquid_babel.messages.extract_liquid()"),". However, Babel's ",(0,r.kt)("a",{parentName:"p",href:"https://babel.pocoo.org/en/latest/cmdline.html#cmdline"},"command-line interface")," and ",(0,r.kt)("a",{parentName:"p",href:"https://babel.pocoo.org/en/latest/setup.html#setup-integration"},"Setuptools integration")," are unlikely to be particularly useful to a typical Liquid use case."),(0,r.kt)("p",null,"If you don't want to work with Babel catalogs or the Babel command-line interface, the lower-level ",(0,r.kt)("inlineCode",{parentName:"p"},"liquid_babel.messages.extract_from_template()")," yields a ",(0,r.kt)("inlineCode",{parentName:"p"},"(lineno, funcname, message, comments)")," tuple for each message in a template. Where ",(0,r.kt)("inlineCode",{parentName:"p"},"message")," could be a string, or a tuple of strings in the case of a pluralizable message."),(0,r.kt)("h3",{id:"translator-comments"},"Translator Comments"),(0,r.kt)("p",null,"When a Liquid comment tag immediately precedes a translatable filter or tag, and the comment starts with a string in ",(0,r.kt)("inlineCode",{parentName:"p"},"comment_tags"),", that comment will be included as a translator comment with the message. Use the ",(0,r.kt)("inlineCode",{parentName:"p"},"comment_tags")," argument to ",(0,r.kt)("inlineCode",{parentName:"p"},"extract_liquid()"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"extract_from_template()")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"extract_from_template()")," to change translator comment prefixes. The default is ",(0,r.kt)("inlineCode",{parentName:"p"},'["Translators:"]'),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'from liquid import Environment\nfrom liquid_babel.filters import register_translation_filters\nfrom liquid_babel.messages import extract_from_templates\nfrom liquid_babel.tags import TranslateTag\n\nenv = Environment()\nregister_translation_filters(env)\nenv.add_tag(TranslateTag)\n\nsource = """\n{% # Translators: some comment %}\n{{ \'Hello, World!\' | t }}\n{% comment %}Translators: other comment{% endcomment %}\n{% translate count: 2 %}\n    Hello, {{ you }}!\n{% plural %}\n    Hello, all!\n{% endtranslate %}\n"""\n\ntemplate = env.from_string(source, name="something.liquid")\ncatalog = extract_from_templates(template, strip_comment_tags=True)\n\nmessage = catalog.get("Hello, World!")\nprint(message.auto_comments[0])  # some comment\n')),(0,r.kt)("p",null,"Note that Python Liquid's ",(0,r.kt)("a",{parentName:"p",href:"/liquid/introduction/comments#alternative-comment-syntax"},"non-standard comment syntax")," is not supported."))}u.isMDXComponent=!0}}]);
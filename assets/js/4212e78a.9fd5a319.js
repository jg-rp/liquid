"use strict";(self.webpackChunkliquid_docs=self.webpackChunkliquid_docs||[]).push([[2109],{9056:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"introduction/caching","title":"Caching","description":"Template Caching","source":"@site/docs/introduction/caching.md","sourceDirName":"introduction","slug":"/introduction/caching","permalink":"/liquid/introduction/caching","draft":false,"unlisted":false,"editUrl":"https://github.com/jg-rp/liquid/tree/docs/docs/introduction/caching.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Async Support","permalink":"/liquid/introduction/async-support"},"next":{"title":"Known Issues","permalink":"/liquid/introduction/known-issues"}}');var s=i(4848),t=i(8453);const c={},o="Caching",a={},l=[{value:"Template Caching",id:"template-caching",level:2},{value:"Expression Caching",id:"expression-caching",level:2},{value:"Caching Template Loaders",id:"caching-template-loaders",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",...(0,t.useMDXComponents)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"caching",children:"Caching"})}),"\n",(0,s.jsx)(n.h2,{id:"template-caching",children:"Template Caching"}),"\n",(0,s.jsxs)(n.p,{children:["An in-memory template cache is included with every ",(0,s.jsx)(n.a,{href:"/liquid/api/Environment",children:(0,s.jsx)(n.code,{children:"Environment"})}),". Templates parsed with ",(0,s.jsx)(n.a,{href:"/liquid/api/Environment#get_template",children:(0,s.jsx)(n.code,{children:"Environment.get_template()"})}),", the ",(0,s.jsx)(n.a,{href:"/liquid/language/tags#render",children:(0,s.jsx)(n.code,{children:"{% render %}"})})," tag or the ",(0,s.jsx)(n.a,{href:"/liquid/language/tags#include",children:(0,s.jsx)(n.code,{children:"{% include %}"})})," tag are stored so as to avoid parsing them multiple times unnecessarily, should that same template be needed again. Templates parsed using ",(0,s.jsx)(n.a,{href:"/liquid/api/Environment#from_string",children:(0,s.jsx)(n.code,{children:"Environment.from_string()"})})," are never cached."]}),"\n",(0,s.jsxs)(n.p,{children:["The default cache size is ",(0,s.jsx)(n.code,{children:"300"})," (that's 300 templates). You can control the cache capacity with the ",(0,s.jsx)(n.code,{children:"cache_size"})," argument to ",(0,s.jsx)(n.a,{href:"/liquid/api/Environment",children:(0,s.jsx)(n.code,{children:"Environment"})})," or ",(0,s.jsx)(n.a,{href:"/liquid/api/Template",children:(0,s.jsx)(n.code,{children:"Template"})}),". Setting ",(0,s.jsx)(n.code,{children:"cache_size"})," to ",(0,s.jsx)(n.code,{children:"0"})," disables template caching altogether."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from liquid import Environment\nenv = Environment(cache_size=800)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Using an ",(0,s.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Cache_replacement_policies#Least_recently_used_(LRU)",children:"LRU"})," policy, the default cache is most effective in situations where the same template is ",(0,s.jsx)(n.a,{href:"/liquid/language/tags#render",children:"rendered"})," or ",(0,s.jsx)(n.a,{href:"/liquid/language/tags#include",children:"included"})," multiple times in a short space of time, or when most of your templates fit in the cache."]}),"\n",(0,s.jsx)(n.h2,{id:"expression-caching",children:"Expression Caching"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.em,{children:"New in version 1.1.0"})})}),"\n",(0,s.jsx)(n.p,{children:"Expression caching is useful in situations where the same Liquid expression appears multiple times in one or more templates. Depending on the nature of your templates, expression caching can significantly improve template parsing performance."}),"\n",(0,s.jsxs)(n.p,{children:["Expression caching is disabled by default. Enable it with the ",(0,s.jsx)(n.code,{children:"expression_cache_size"})," argument to ",(0,s.jsx)(n.a,{href:"/liquid/api/Environment",children:(0,s.jsx)(n.code,{children:"Environment"})})," or ",(0,s.jsx)(n.a,{href:"/liquid/api/Template",children:(0,s.jsx)(n.code,{children:"Template"})}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from liquid import Environment\nenv = Environment(expression_cache_size=80)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["An ",(0,s.jsx)(n.a,{href:"/liquid/api/Environment",children:(0,s.jsx)(n.code,{children:"Environment"})})," will manage one cache for each of the common, built-in expression types, ",(0,s.jsx)(n.em,{children:"filtered"}),", ",(0,s.jsx)(n.em,{children:"boolean"})," and ",(0,s.jsx)(n.em,{children:"loop"})," expressions. Each uses an ",(0,s.jsx)(n.a,{href:"https://docs.python.org/3/library/functools.html#functools.lru_cache",children:"lru_cache"})," from Python's ",(0,s.jsx)(n.a,{href:"https://docs.python.org/3/library/functools.html#module-functools",children:"functools"})," module. You can inspect cache ",(0,s.jsx)(n.em,{children:"hits"}),", ",(0,s.jsx)(n.em,{children:"misses"})," and ",(0,s.jsx)(n.em,{children:"currsize"})," for each using the ",(0,s.jsx)(n.code,{children:"cache_info()"})," function of ",(0,s.jsx)(n.code,{children:"Environment.parse_filtered_expression_value"}),", ",(0,s.jsx)(n.code,{children:"Environment.parse_boolean_expression_value"})," and ",(0,s.jsx)(n.code,{children:"Environment.parse_loop_expression_value"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Tests with the ",(0,s.jsx)(n.a,{href:"https://github.com/jg-rp/liquid/tree/main/tests/fixtures",children:"benchmark fixtures"})," show that extra memory used from caching expressions is offset by the reduced size of the resulting syntax trees."]}),"\n",(0,s.jsx)(n.h2,{id:"caching-template-loaders",children:"Caching Template Loaders"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.em,{children:"New in version 1.9.0"})})}),"\n",(0,s.jsxs)(n.p,{children:["An ",(0,s.jsx)(n.a,{href:"/liquid/api/Environment",children:(0,s.jsx)(n.code,{children:"Environment"})}),"-wide template cache does not work well with ",(0,s.jsx)(n.a,{href:"/liquid/guides/custom-loaders#loading-with-context",children:"context aware loaders"}),". This is because the environment has no way of knowing what context variables might be used to build a cache key. For this reason it is recommended to use ",(0,s.jsx)(n.a,{href:"/liquid/api/cachingfilesystemloader",children:(0,s.jsx)(n.code,{children:"CachingFileSystemLoader"})})," or ",(0,s.jsx)(n.a,{href:"/liquid/api/cachingchoiceloader",children:(0,s.jsx)(n.code,{children:"CachingChoiceLoader"})})," which, by default, replace the environment cache."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from liquid import CachingFileSystemLoader\nfrom liquid import Environment\n\nloader = CachingFileSystemLoader("templates/", cache_size=500)\nenv = Environment(loader=loader)\n\n# ...\n'})})]})}function h(e={}){const{wrapper:n}={...(0,t.useMDXComponents)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.r(n),i.d(n,{MDXProvider:()=>o,useMDXComponents:()=>c});var r=i(6540);const s={},t=r.createContext(s);function c(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);
"use strict";(self.webpackChunkliquid_docs=self.webpackChunkliquid_docs||[]).push([[9853],{3905:(e,n,t)=>{t.r(n),t.d(n,{MDXContext:()=>l,MDXProvider:()=>c,mdx:()=>g,useMDXComponents:()=>s,withMDXComponents:()=>d});var a=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(){return r=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},r.apply(this,arguments)}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function m(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=a.createContext({}),d=function(e){return function(n){var t=s(n.components);return a.createElement(e,r({},n,{components:t}))}},s=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):m(m({},n),e)),t},c=function(e){var n=s(e.components);return a.createElement(l.Provider,{value:n},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},f=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,o=e.parentName,l=p(e,["components","mdxType","originalType","parentName"]),d=s(t),c=i,u=d["".concat(o,".").concat(c)]||d[c]||h[c]||r;return t?a.createElement(u,m(m({ref:n},l),{},{components:t})):a.createElement(u,m({ref:n},l))}));function g(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=f;var m={};for(var p in n)hasOwnProperty.call(n,p)&&(m[p]=n[p]);m.originalType=e,m[u]="string"==typeof e?e:i,o[1]=m;for(var l=2;l<r;l++)o[l]=t[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}f.displayName="MDXCreateElement"},9191:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>m,toc:()=>l});var a=t(7462),i=(t(7294),t(3905));const r={},o="Caching",m={unversionedId:"introduction/caching",id:"introduction/caching",title:"Caching",description:"Template Caching",source:"@site/docs/introduction/caching.md",sourceDirName:"introduction",slug:"/introduction/caching",permalink:"/liquid/introduction/caching",draft:!1,editUrl:"https://github.com/jg-rp/liquid/tree/docs/docs/introduction/caching.md",tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Async Support",permalink:"/liquid/introduction/async-support"},next:{title:"Custom Filters",permalink:"/liquid/guides/custom-filters"}},p={},l=[{value:"Template Caching",id:"template-caching",level:2},{value:"Expression Caching",id:"expression-caching",level:2},{value:"Caching Template Loaders",id:"caching-template-loaders",level:2}],d={toc:l},s="wrapper";function c(e){let{components:n,...t}=e;return(0,i.mdx)(s,(0,a.default)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,i.mdx)("h1",{id:"caching"},"Caching"),(0,i.mdx)("h2",{id:"template-caching"},"Template Caching"),(0,i.mdx)("p",null,"An in-memory template cache is included with every ",(0,i.mdx)("a",{parentName:"p",href:"/liquid/api/Environment"},(0,i.mdx)("inlineCode",{parentName:"a"},"Environment")),". Templates parsed with ",(0,i.mdx)("a",{parentName:"p",href:"/liquid/api/Environment#get_template"},(0,i.mdx)("inlineCode",{parentName:"a"},"Environment.get_template()")),", the ",(0,i.mdx)("a",{parentName:"p",href:"/liquid/language/tags#render"},(0,i.mdx)("inlineCode",{parentName:"a"},"{% render %}"))," tag or the ",(0,i.mdx)("a",{parentName:"p",href:"/liquid/language/tags#include"},(0,i.mdx)("inlineCode",{parentName:"a"},"{% include %}"))," tag are stored so as to avoid parsing them multiple times unnecessarily, should that same template be needed again. Templates parsed using ",(0,i.mdx)("a",{parentName:"p",href:"/liquid/api/Environment#from_string"},(0,i.mdx)("inlineCode",{parentName:"a"},"Environment.from_string()"))," are never cached."),(0,i.mdx)("p",null,"The default cache size is ",(0,i.mdx)("inlineCode",{parentName:"p"},"300")," (that's 300 templates). You can control the cache capacity with the ",(0,i.mdx)("inlineCode",{parentName:"p"},"cache_size")," argument to ",(0,i.mdx)("a",{parentName:"p",href:"/liquid/api/Environment"},(0,i.mdx)("inlineCode",{parentName:"a"},"Environment"))," or ",(0,i.mdx)("a",{parentName:"p",href:"/liquid/api/Template"},(0,i.mdx)("inlineCode",{parentName:"a"},"Template")),". Setting ",(0,i.mdx)("inlineCode",{parentName:"p"},"cache_size")," to ",(0,i.mdx)("inlineCode",{parentName:"p"},"0")," disables template caching altogether."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"from liquid import Environment\nenv = Environment(cache_size=800)\n")),(0,i.mdx)("p",null,"Using an ",(0,i.mdx)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Cache_replacement_policies#Least_recently_used_(LRU)"},"LRU")," policy, the default cache is most effective in situations where the same template is ",(0,i.mdx)("a",{parentName:"p",href:"/liquid/language/tags#render"},"rendered")," or ",(0,i.mdx)("a",{parentName:"p",href:"/liquid/language/tags#include"},"included")," multiple times in a short space of time, or when most of your templates fit in the cache."),(0,i.mdx)("h2",{id:"expression-caching"},"Expression Caching"),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},(0,i.mdx)("em",{parentName:"strong"},"New in version 1.1.0"))),(0,i.mdx)("p",null,"Expression caching is useful in situations where the same Liquid expression appears multiple times in one or more templates. Depending on the nature of your templates, expression caching can significantly improve template parsing performance."),(0,i.mdx)("p",null,"Expression caching is disabled by default. Enable it with the ",(0,i.mdx)("inlineCode",{parentName:"p"},"expression_cache_size")," argument to ",(0,i.mdx)("a",{parentName:"p",href:"/liquid/api/Environment"},(0,i.mdx)("inlineCode",{parentName:"a"},"Environment"))," or ",(0,i.mdx)("a",{parentName:"p",href:"/liquid/api/Template"},(0,i.mdx)("inlineCode",{parentName:"a"},"Template")),"."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"from liquid import Environment\nenv = Environment(expression_cache_size=80)\n")),(0,i.mdx)("p",null,"An ",(0,i.mdx)("a",{parentName:"p",href:"/liquid/api/Environment"},(0,i.mdx)("inlineCode",{parentName:"a"},"Environment"))," will manage one cache for each of the common, built-in expression types, ",(0,i.mdx)("em",{parentName:"p"},"filtered"),", ",(0,i.mdx)("em",{parentName:"p"},"boolean")," and ",(0,i.mdx)("em",{parentName:"p"},"loop")," expressions. Each uses an ",(0,i.mdx)("a",{parentName:"p",href:"https://docs.python.org/3/library/functools.html#functools.lru_cache"},"lru_cache")," from Python's ",(0,i.mdx)("a",{parentName:"p",href:"https://docs.python.org/3/library/functools.html#module-functools"},"functools")," module. You can inspect cache ",(0,i.mdx)("em",{parentName:"p"},"hits"),", ",(0,i.mdx)("em",{parentName:"p"},"misses")," and ",(0,i.mdx)("em",{parentName:"p"},"currsize")," for each using the ",(0,i.mdx)("inlineCode",{parentName:"p"},"cache_info()")," function of ",(0,i.mdx)("inlineCode",{parentName:"p"},"Environment.parse_filtered_expression_value"),", ",(0,i.mdx)("inlineCode",{parentName:"p"},"Environment.parse_boolean_expression_value")," and ",(0,i.mdx)("inlineCode",{parentName:"p"},"Environment.parse_loop_expression_value"),"."),(0,i.mdx)("p",null,"Tests with the ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/jg-rp/liquid/tree/main/tests/fixtures"},"benchmark fixtures")," show that extra memory used from caching expressions is offset by the reduced size of the resulting syntax trees."),(0,i.mdx)("h2",{id:"caching-template-loaders"},"Caching Template Loaders"),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},(0,i.mdx)("em",{parentName:"strong"},"New in version 1.9.0"))),(0,i.mdx)("p",null,"An ",(0,i.mdx)("a",{parentName:"p",href:"/liquid/api/Environment"},(0,i.mdx)("inlineCode",{parentName:"a"},"Environment"))," template cache does not work well with ",(0,i.mdx)("a",{parentName:"p",href:"/liquid/guides/custom-loaders#loading-with-context"},"context aware loaders"),", because the environment has no way of knowing what context variables might be used to build a cache key. For this reason it is recommended to use ",(0,i.mdx)("a",{parentName:"p",href:"/liquid/api/cachingfilesystemloader"},(0,i.mdx)("inlineCode",{parentName:"a"},"CachingFileSystemLoader"))," which, by default, replaces the environment cache."),(0,i.mdx)("admonition",{type:"info"},(0,i.mdx)("p",{parentName:"admonition"},'With hindsight, considering how typical Liquid use cases differ from "traditional" template engine usage, we should never have provided an environment-wide template cache. Come Liquid version 2.0 (unreleased), all template caching will be handled by template loaders.')),(0,i.mdx)("p",null,"See ",(0,i.mdx)("a",{parentName:"p",href:"/liquid/introduction/loading-templates#caching-file-system-loader"},"Caching File System Loader")," for example usage."))}c.isMDXComponent=!0}}]);